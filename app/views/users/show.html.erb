<% title t('user.my_profile') %>
<% if current_user %>
<%= render :partial => 'write_message' %>
<% end %>

<div class="personal_info">
	<% if current_user && !@current_one %>
	<div class="friendship_links_top">
		<%= render 'friendship_links_top' %>
	</div>	
	<% end %>
	<h1><%= t "user.common" %></h1>
	<% if current_user && @current_one %>
		<%= link_to_unless_current t("common.edit"), :controller => "user_commons", :action => "edit", :id => current_user.id %>
	<% end %>
	<dl>
		<% if !(@user_common.gender.to_s == "") %>
		<dt>
			<%= t "user.gender" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.gender %>
		</dd>
		<% end %>
		<% if !(@user_common.title.to_s == "") %>
		<dt>
			<%= t "user.title" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.title %>
		</dd>
		<% end %>
		<% if !((@user_common.firstname.to_s == "") && (@user_common.lastname.to_s == "")) %>
		<dt>
			<%= t "user.name" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.firstname %>
			<%= " " %>
			<%= @user_common.lastname %>
		</dd>
		<% end %>
		<% if !(@user_common.street.to_s == "") %>
		<dt>
			<%= t "user.street" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.street %>
		</dd>
		<% end %>
		<% if !(@user_common.zip.to_s == "") %>
		<dt>
			<%= t "user.zip" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.zip %>
		</dd>
		<% end %>
		<% if !(@user_common.city.to_s == "") %>
		<dt>
			<%= t "user.city" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.city %>
		</dd>
		<% end %>
		<% if !(@user_common.district.to_s == "") %>
		<dt>
			<%= t "user.district" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.district %>
		</dd>
		<% end %>
		<% if !(@user_common.administrative_area.to_s == "") %>
		<dt>
			<%= t "user.administrative_area" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.administrative_area %>
		</dd>
		<% end %>
		<% if !(@user_common.state.to_s == "") %>
		<dt>
			<%= t "user.state" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.state %>
		</dd>
		<% end %>
		<% if !(@user_common.www.to_s == "") %>
		<dt>
			<%= t "user.www" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.www %>
		</dd>
		<% end %>
		<% if !(@user_common.phone.to_s == "") %>
		<dt>
			<%= t "user.phone" %>
			<%= ":" %>
		</dt>
		<dd>
			<%= @user_common.phone %>
		</dd>
		<% end %>
	</dl>
	
</div>





<div class="info_and_entry">
	<div class="account_info">
		<ul>
			<% if current_user && @current_one %>
			<li>
				<%= link_to t('user.delete'), destroy_user_path, :confirm  => t("common.confirm") %>
			</li>
			<% end %>
			<li>
				<%= t "common.login_name" %>: <%=h @user.login %>
			</li>
			<li>
				<% if @user.last_login_at %>
				<%= t "profile.last_login" %>: <%= l @user.last_login_at, :format => :long %>
				<% end %>
			</li>
			<li>
				<%= t "common.email" %>: <%= mail_to h@user.email %>
			</li>
			<% if current_user %>
			<li>
				<div id="button_popup">
					<a href="/sent/new?user=<%= @user.id %>"><%= t("common.send_message_to_user") %></a>
				</div>
			</li>
			<% end %>
			<% unless @user.photo_albums.empty? %>
			<li>
				<%= link_to (t('photo_album.of_this_user').to_s << ' ' << @user.login.to_s), user_photo_albums_url(@user) %>
			</li>
			<% end %>
			<% unless @user.own_groups.empty? %>
			<li>
				<%= link_to (t('group.of_this_user').to_s << ' ' << @user.login.to_s), user_groups_url(@user) %>
			</li>
			<% end %>
			<% unless @user.posts.empty? %>
			<li>
				<%= link_to (t('post.of_this_user').to_s << ' ' << @user.login.to_s), user_posts_url(@user) %>
			</li>
			<% end %>
		</ul>
	</div>

	<h1><%= t "common.profile_entries" %></h1>
	<%= render '/comments/form' %>
	<div id="comments">
		<%= render :partial => '/comments/create' %>
	</div>
</div>

<div class="attributes">
	<% for assign in Assign.roots %>
	<% unless (@user.assigns.uniq & Assign.find_all_by_parent_id(assign.id)).size == 0 %>
	<h1><%= assign.assign_names.find_by_language(get_locale.to_s).name %></h1>
	<% if current_user %>
	<% if @user == current_user %>
	<%= link_to t('common.edit'), assign_path(assign) %>
	<% end %>
	<% end %>
	<dl>
		<% for assign_child in assign.children %>
		<% unless UserAssignValue.find_all_by_assignable_id_and_assign_id(@user.id, assign_child.id).empty? %>
		<% unless UserAssignValue.find_all_by_assignable_id_and_assign_id(@user.id, assign_child.id).size == 1 && UserAssignValue.find_all_by_assignable_id_and_assign_id(@user.id, assign_child.id).first.value.to_s.eql?('') %>
		<dt>
			<%= assign_child.assign_names.find_by_language(get_locale.to_s).name + ":" %>
		</dt>
		<dd>
			<%= UserAssignValue.find_all_by_assignable_id_and_assign_id(@user.id, assign_child.id).map(&:value).join(', ') %>
		</dd>
		<% end %>
		<% end %>
		<% end %>
	</dl>
	<% end %>

	<% end %>
	
	<div class="friends">
		<%= render :partial => 'friends' %>
	</div>
	<div class="friendship_links_bottom">
		<%= render 'friendship_links_bottom' %>
	</div>
</div>


<div class="profile_image">
    <% if @profile_image %>
		<a href='<%= @profile_image.avatar.url %>' rel='shadowbox'><%= image_tag @profile_image.avatar.url(:small) %></a>
	 <% else %>
	 <%= image_tag '/images/anonymous.jpg', :width  => 150 %>
    <% end %>
</div>
